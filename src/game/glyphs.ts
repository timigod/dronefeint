const GLYPH_WIDTH = 5;
const GLYPH_HEIGHT = 7;

const GLYPH_PATTERNS: Record<string, string[]> = {
  '0': ['01110','10001','10001','10001','10001','10001','01110'],
  '1': ['00100','01100','00100','00100','00100','00100','01110'],
  '2': ['01110','10001','00001','00110','01000','10000','11111'],
  '3': ['01110','10001','00001','00110','00001','10001','01110'],
  '4': ['10010','10010','10010','11111','00010','00010','00010'],
  '5': ['11111','10000','11110','00001','00001','10001','01110'],
  '6': ['00110','01000','10000','11110','10001','10001','01110'],
  '7': ['11111','00001','00010','00100','01000','01000','01000'],
  '8': ['01110','10001','10001','01110','10001','10001','01110'],
  '9': ['01110','10001','10001','01111','00001','00010','01100'],
  'A': ['01110','10001','10001','11111','10001','10001','10001'],
  'B': ['11110','10001','10001','11110','10001','10001','11110'],
  'C': ['01110','10001','10000','10000','10000','10001','01110'],
  'D': ['11110','10001','10001','10001','10001','10001','11110'],
  'E': ['11111','10000','11110','10000','10000','10000','11111'],
  'F': ['11111','10000','11110','10000','10000','10000','10000'],
  'G': ['01110','10001','10000','10111','10001','10001','01110'],
  'H': ['10001','10001','10001','11111','10001','10001','10001'],
  'I': ['01110','00100','00100','00100','00100','00100','01110'],
  'J': ['00111','00010','00010','00010','10010','10010','01100'],
  'K': ['10001','10010','10100','11000','10100','10010','10001'],
  'L': ['10000','10000','10000','10000','10000','10000','11111'],
  'M': ['10001','11011','10101','10101','10001','10001','10001'],
  'N': ['10001','11001','10101','10011','10001','10001','10001'],
  'O': ['01110','10001','10001','10001','10001','10001','01110'],
  'P': ['11110','10001','10001','11110','10000','10000','10000'],
  'Q': ['01110','10001','10001','10001','10001','10011','01111'],
  'R': ['11110','10001','10001','11110','10100','10010','10001'],
  'S': ['01111','10000','10000','01110','00001','00001','11110'],
  'T': ['11111','00100','00100','00100','00100','00100','00100'],
  'U': ['10001','10001','10001','10001','10001','10001','01110'],
  'V': ['10001','10001','10001','10001','01010','01010','00100'],
  'W': ['10001','10001','10001','10101','10101','10101','01010'],
  'X': ['10001','01010','00100','00100','00100','01010','10001'],
  'Y': ['10001','01010','00100','00100','00100','00100','00100'],
  'Z': ['11111','00001','00010','00100','01000','10000','11111'],
  '+': ['00000','00100','00100','11111','00100','00100','00000'],
  "'": ['00100','00100','00100','00100','01000','00000','00000'],
  '/': ['00001','00010','00100','01000','10000','00000','00000'],
  ' ': ['00000','00000','00000','00000','00000','00000','00000'],
  '~': ['00000','00000','01010','10101','00000','00000','00000'],
};

const drawGlyphChar = (
  ctx: CanvasRenderingContext2D,
  char: string,
  x: number,
  y: number,
  r: number,
  g: number,
  b: number,
  scale = 1
) => {
  const pattern = GLYPH_PATTERNS[char] || GLYPH_PATTERNS[' '];
  ctx.fillStyle = `rgba(${r}, ${g}, ${b}, 0.95)`;
  for (let row = 0; row < GLYPH_HEIGHT; row += 1) {
    for (let col = 0; col < GLYPH_WIDTH; col += 1) {
      if (pattern[row][col] === '1') {
        ctx.fillRect(x + col * scale, y + row * scale, scale, scale);
      }
    }
  }
};

const measureGlyphText = (text: string, scale = 1) => {
  if (!text.length) return 0;
  const advance = (GLYPH_WIDTH + 1) * scale;
  return text.length * advance - scale;
};

const drawGlyphText = (
  ctx: CanvasRenderingContext2D,
  text: string,
  x: number,
  y: number,
  r: number,
  g: number,
  b: number,
  scale = 1
) => {
  const advance = (GLYPH_WIDTH + 1) * scale;
  let offsetX = 0;
  for (const char of text) {
    drawGlyphChar(ctx, char.toUpperCase(), x + offsetX, y, r, g, b, scale);
    offsetX += advance;
  }
};

export {
  GLYPH_HEIGHT,
  GLYPH_WIDTH,
  drawGlyphChar,
  drawGlyphText,
  measureGlyphText,
};

